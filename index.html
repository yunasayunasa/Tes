<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タイムライン構築ミステリ：消えた青いクッキー</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --container-bg: #ffffff;
            --timeline-bg: #e4e6eb;
            --card-bg: #ffffff;
            --text-color: #333;
            --title-color: #1a73e8;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --drop-hover-bg: #d9eaff;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 10px;
        }
        .game-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--container-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow-color);
            padding: 16px;
        }
        h1 {
            color: var(--title-color);
            text-align: center;
            border-bottom: 2px solid var(--title-color);
            padding-bottom: 10px;
            font-size: 1.5em;
        }
        p {
            line-height: 1.7;
        }
        .area-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 30px;
            margin-bottom: 10px;
            border-left: 5px solid var(--title-color);
            padding-left: 10px;
        }
        .card-pool {
            background-color: var(--timeline-bg);
            border-radius: 8px;
            padding: 15px;
            min-height: 50px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .card {
            background-color: var(--card-bg);
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            cursor: grab;
            box-shadow: 0 2px 4px var(--shadow-color);
            transition: transform 0.2s, box-shadow 0.2s;
            touch-action: none; /* スマホでのスクロールを防止 */
        }
        .person-card {
            font-weight: bold;
            text-align: center;
            flex-grow: 1;
        }
        .testimony-card {
            width: 100%;
        }
        .card:active {
            cursor: grabbing;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .timeline-slot {
            background-color: var(--container-bg);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            gap: 15px;
            align-items: stretch;
        }
        .person-dropzone, .testimony-dropzone {
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .person-dropzone {
            width: 120px;
            min-height: 50px;
            flex-shrink: 0;
        }
        .testimony-dropzone {
            flex-grow: 1;
            min-height: 80px;
        }
        .person-dropzone.drag-over, .testimony-dropzone.drag-over {
            background-color: var(--drop-hover-bg);
            border-color: var(--title-color);
        }
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        #check-answer-btn {
            background-color: var(--title-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #check-answer-btn:hover {
            background-color: #155ab3;
        }
        #result-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        .correct { background-color: #d4edda; color: #155724; }
        .incorrect { background-color: #f8d7da; color: #721c24; }
        
        /* ★★★ ここからがスマホ対応のCSS ★★★ */
        @media (max-width: 600px) {
            body {
                padding: 5px;
            }
            .game-container {
                padding: 10px;
            }
            .timeline-slot {
                flex-direction: column; /* 縦並びに変更 */
            }
            .person-dropzone {
                width: auto; /* 幅を自動調整 */
                min-height: 40px;
            }
            .testimony-card {
                font-size: 0.9em; /* 少し文字を小さくして読みやすく */
            }
        }
    </style>
</head>
<body>

<div class="game-container">
    <h1>消えた青いクッキー</h1>
    <p>研究室から貴重な「青いクッキー」が一つだけ消えた。下の【人物カード】と【証言カード】をドラッグし、【タイムライン】で正しい組み合わせと順番を完成させよう。</p>

    <div class="area-title">人物カード</div>
    <div id="person-pool" class="card-pool"></div>

    <div class="area-title">証言カード</div>
    <div id="testimony-pool" class="card-pool"></div>
    
    <div class="area-title">タイムライン</div>
    <id id="timeline-area" class="timeline"></id>

    <div class="button-container">
        <button id="check-answer-btn">判定する</button>
    </div>

    <div id="result-area"></div>
</div>

<script>
    const data = [
        { id: 'akari', name: 'アカリ (博士)', text: '私の助手が来る直前に気づいたの。私の研究成果であるクッキーが一つだけ…。食べると体が青く光るという特殊な効果があるのに。', order: 4 },
        { id: 'kaito', name: 'カイト (助手)', text: '博士、すごい剣幕でしたよ。「クッキーがない！」って。僕がおやつの催促に行ったばかりに、博士の機嫌を損ねてしまいました…。', order: 3 },
        { id: 'hinata', name: 'ヒナタ (学生)', text: '私、一番最初に見学させてもらったんです！テーブルの上にあった青いクッキー、キラキラしてて宝石みたいでした！', order: 1 },
        { id: 'yuuki', name: 'ユウキ (警備員)', text: '私の巡回記録によれば、研究室の前を通った時、特に異常はありませんでした。ドアも施錠されていましたし。学生さんの見学の後のことです。', order: 2 },
        { id: 'mio', name: 'ミオ (清掃員)', text: '一日の終わりに掃除をしていたら、研究室のゴミ箱に小さな銀紙が。他のゴミとは違う、お菓子の包み紙みたいでした。床は綺麗でしたよ。', order: 5 }
    ];

    const personPool = document.getElementById('person-pool');
    const testimonyPool = document.getElementById('testimony-pool');
    const timelineArea = document.getElementById('timeline-area');
    const checkBtn = document.getElementById('check-answer-btn');
    const resultArea = document.getElementById('result-area');

    function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }

    shuffle([...data]).forEach(item => { const card = document.createElement('div'); card.id = `person-${item.id}`; card.className = 'card person-card'; card.draggable = true; card.textContent = item.name; personPool.appendChild(card); });
    shuffle([...data]).forEach(item => { const card = document.createElement('div'); card.id = `testimony-${item.id}`; card.className = 'card testimony-card'; card.draggable = true; card.textContent = `「${item.text}」`; testimonyPool.appendChild(card); });

    for (let i = 1; i <= data.length; i++) { const slot = document.createElement('div'); slot.className = 'timeline-slot'; slot.dataset.order = i; slot.innerHTML = `<div class="person-dropzone" data-type="person"></div><div class="testimony-dropzone" data-type="testimony"></div>`; timelineArea.appendChild(slot); }

    let draggedItem = null;
    document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('dragstart', (e) => {
            draggedItem = e.target;
            setTimeout(() => e.target.style.opacity = '0.5', 0);
        });
        card.addEventListener('dragend', (e) => {
            setTimeout(() => {
                draggedItem.style.opacity = '1';
                draggedItem = null;
            }, 0);
        });
    });

    document.querySelectorAll('.person-dropzone, .testimony-dropzone, .card-pool').forEach(zone => {
        zone.addEventListener('dragover', e => { e.preventDefault(); });
        zone.addEventListener('dragenter', e => { if (e.target.closest('.person-dropzone, .testimony-dropzone, .card-pool')) { e.target.closest('.person-dropzone, .testimony-dropzone, .card-pool').classList.add('drag-over'); } });
        zone.addEventListener('dragleave', e => { if (e.target.closest('.person-dropzone, .testimony-dropzone, .card-pool')) { e.target.closest('.person-dropzone, .testimony-dropzone, .card-pool').classList.remove('drag-over'); } });
        zone.addEventListener('drop', e => {
            e.preventDefault();
            const targetZone = e.target.closest('.person-dropzone, .testimony-dropzone, .card-pool');
            if (!targetZone || !draggedItem) return;
            targetZone.classList.remove('drag-over');
            
            const isPersonCard = draggedItem.classList.contains('person-card');
            const targetIsPersonZone = targetZone.dataset.type === 'person';
            const targetIsPersonPool = targetZone.id === 'person-pool';
            const targetIsTestimonyZone = targetZone.dataset.type === 'testimony';
            const targetIsTestimonyPool = targetZone.id === 'testimony-pool';

            if ((isPersonCard && (targetIsPersonZone || targetIsPersonPool)) || (!isPersonCard && (targetIsTestimonyZone || targetIsTestimonyPool))) {
                if (targetZone.children.length > 0 && !targetZone.classList.contains('card-pool')) {
                    const existingCard = targetZone.firstChild;
                    const pool = existingCard.classList.contains('person-card') ? personPool : testimonyPool;
                    pool.appendChild(existingCard);
                }
                targetZone.appendChild(draggedItem);
            }
        });
    });

    checkBtn.addEventListener('click', () => {
        let isCorrect = true;
        let isComplete = true;
        document.querySelectorAll('.timeline-slot').forEach(slot => {
            const order = parseInt(slot.dataset.order);
            const personCard = slot.querySelector('.person-card');
            const testimonyCard = slot.querySelector('.testimony-card');
            if (!personCard || !testimonyCard) { isComplete = false; return; }
            const personId = personCard.id.replace('person-', '');
            const testimonyId = testimonyCard.id.replace('testimony-', '');
            const correctItem = data.find(item => item.order === order);
            if (personId !== correctItem.id || testimonyId !== correctItem.id) { isCorrect = false; }
        });

        if (!isComplete) { resultArea.className = 'incorrect'; resultArea.innerHTML = 'まだ全てのカードがタイムラインに置かれていないようだ…'; }
        else if (isCorrect) { resultArea.className = 'correct'; resultArea.innerHTML = `【お見事！タイムライン完成！】\n\n一連の出来事は、こうだ。\n\n1.【ヒナタ】「一番最初に見学した」という証言。\n2.【ユウキ】「学生さんの見学の後」に巡回。\n3.【カイト】「おやつの催促に行った」ら事件発覚。\n4.【アカリ】「私の助手が来る直前に気づいた」と証言。カイトの直前の出来事。\n5.【ミオ】「一日の終わりに掃除」中に犯人の痕跡を発見。\n\n【真相】\n犯人は……学生のヒナタだ。\n彼女は「キラキラしてて宝石みたい」という理由で、食べるためではなくコレクション目的でクッキーを盗んだ。だから体が光ることはなかった。\n慌てていたため、持っていた別のお菓子のゴミ（銀紙）を研究室のゴミ箱に捨ててしまったのが、決定的な証拠となった。`; }
        else { resultArea.className = 'incorrect'; resultArea.innerHTML = 'うーん、人物、証言、時系列のどこかに矛盾があるようだ。もう一度よく考えてみよう。'; }
    });
</script>
</body>
</html>